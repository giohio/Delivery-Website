<!DOCTYPE html>
<html>
<head>
    <title>Check Session</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; }
        .section { margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Session Debug Info</h1>
    
    <div class="section">
        <h2>SessionStorage</h2>
        <pre id="sessionInfo"></pre>
    </div>
    
    <div class="section">
        <h2>Decoded JWT</h2>
        <pre id="jwtInfo"></pre>
    </div>
    
    <div class="section">
        <h2>API Test</h2>
        <button onclick="testWalletAPI()">Test Wallet API</button>
        <pre id="apiResponse"></pre>
    </div>

    <script>
        // Show session storage
        const session = {};
        for (let i = 0; i < sessionStorage.length; i++) {
            const key = sessionStorage.key(i);
            session[key] = sessionStorage.getItem(key);
        }
        document.getElementById('sessionInfo').textContent = JSON.stringify(session, null, 2);

        // Decode JWT
        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                return { error: e.message };
            }
        }

        const token = sessionStorage.getItem('token');
        if (token) {
            const decoded = parseJwt(token);
            document.getElementById('jwtInfo').textContent = JSON.stringify(decoded, null, 2);
        } else {
            document.getElementById('jwtInfo').textContent = 'No token found';
        }

        // Test API
        async function testWalletAPI() {
            const apiResponse = document.getElementById('apiResponse');
            apiResponse.textContent = 'Loading...';
            
            try {
                const response = await fetch('http://localhost:5000/wallet', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();
                apiResponse.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                apiResponse.textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
